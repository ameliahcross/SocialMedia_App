@using SocialMedia_App.Core.Application.ViewModels.Home
@using SocialMedia_App.Core.Application.ViewModels.User
@model HomeViewModel

@inject IHttpContextAccessor httpContext;
@using Microsoft.AspNetCore.Http;
@using SocialMedia_App.Core.Application.Helpers;
@{
    UserViewModel User = httpContext.HttpContext.Session.Get<UserViewModel>("user");
    ViewData["Title"] = "Feed";
}

@section Sidebar {
    <div class="col-md-3 col-xl-2 bg-dark sidebar vh-100">
        <ul class="nav nav-pills flex-column mb-auto">
            <li class="nav-item">
                <a class="nav-link active text-white" aria-current="page" asp-controller="Home" asp-action="Index" asp-route-id="@User.Id">
                    <i class="fas fa-home"></i> Inicio
                </a>
            </li>
            <li>
                <a class="nav-link text-white" asp-controller="Friendship" asp-action="Index" asp-route-id="@User.Id">
                    <i class="fas fa-user-friends"></i> Amigos
                </a>
            </li>
            <li>
                <a class="nav-link text-white" asp-controller="Profile" asp-action="Edit" asp-route-id="@User.Id">
                    <i class="fas fa-user"></i> Mi Perfil
                </a>
            </li>
        </ul>
    </div>
}

<div class="row">
    <h4 class="mt-2 text-center text-primary"> Hola, @User.UserName.</h4>
    <h3 class="mt-2 text-center"> Tu feed</h3>

    @* formulario para crear publicaciones *@
    <div class="row mt-3 justify-content-center">
        <div class="col-md-5">
            <form asp-controller="Post" asp-action="Create" method="post" enctype="multipart/form-data">
                <div class="form-group mt-2">
                    <label for="NewPost_Content">Comparte algo de ti:</label>
                    <textarea class="form-control" asp-for="NewPost.Content" rows="3"></textarea>
                </div>
                <div class="form-group mt-2">
                    <label for="NewPost_Image">O carga una imagen</label>
                    <input type="file" class="form-control-file" asp-for="NewPost.PostImageUrl">
                </div>
                <div class="form-group mt-2">
                    <label for="NewPost_YouTubeLink">También puedes compartir un link de YouTube:</label>
                    <input type="text" class="form-control" asp-for="NewPost.YouTubeLink">
                </div>
                <input asp-for="Id" type="hidden">
                <button type="submit" class="btn btn-primary offset-10 mt-3">Publicar</button>
            </form>
        </div>
    </div>

    @* listado de publicaciones y sus comentarios *@
    <div class="container mt-5">
        <div class="row justify-content-center">
            @if (Model == null || Model.Posts.Count == 0)
            {
                <p>No hay publicaciones disponibles.</p>
            }
            else
            {
                @foreach (var post in Model.Posts)
                {
                    <div class="card mt-3">
                        <div class="card-header">
                            <div class="d-flex align-items-center">
                                <img src="@post.UserImageUrl" class="rounded-circle" width="40" height="40" alt="Foto de perfil">
                                <span class="ml-2">@post.UserName</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <p>@post.Content</p>
                            @if (!string.IsNullOrEmpty(post.PostImageUrl))
                            {
                                <img src="@post.PostImageUrl" class="img-fluid" alt="Imagen de la publicación">
                            }
                            @if (!string.IsNullOrEmpty(post.YouTubeLink))
                            {
                                <div class="embed-responsive embed-responsive-16by9 mt-2">
                                    <iframe class="embed-responsive-item" src="@post.YouTubeLink" allowfullscreen></iframe>
                                </div>
                            }
                        </div>
                        <div class="card-footer">
                            <button type="button" class="btn btn-sm btn-primary">Responder</button>
                            <button type="button" class="btn btn-sm btn-danger">Modificar</button>
                            <a asp-controller="Post" asp-action="Delete" class="btn btn-sm btn-warning">Eliminar</a>
                        </div>
                    </div>

                    @if (post.Comments != null && post.Comments.Any())
                    {
                        foreach (var comentario in post.Comments)
                        {
                            <div class="card mt-3 ml-4">
                                <div class="card-header">
                                    <div class="d-flex align-items-center">
                                        <img src="@comentario.UserImageUrl" class="rounded-circle" width="30" height="30" alt="Foto de perfil">
                                        <span class="ml-2">@comentario.UserName</span>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <p>@comentario.Content</p>
                                </div>
                                <div class="card-footer">
                                    <button type="button" class="btn btn-sm btn-primary">Responder</button>
                                    <button type="button" class="btn btn-sm btn-warning">Eliminar</button>
                                </div>
                            </div>
                        }
                    }
                }
            }
        </div>
    </div>

</div>